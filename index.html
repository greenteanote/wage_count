<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>받을 월급</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Noto Sans KR', sans-serif;
      }
    </style>
  <!-- Babel Standalone for live JSX transformation -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <!-- 
      React and ReactDOM are loaded via traditional script tags from a reliable CDN.
      This makes them available as global variables (window.React, window.ReactDOM)
      and avoids all in-browser module loading issues.
    -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- 
      All application code is inlined here as pure JavaScript + JSX.
      It's a simple Babel script, not a module, so no 'import' statements are needed.
    -->
    <script type="text/babel">
// React and ReactDOM are globally available from the scripts above.

// --- Helper Functions ---

const getWorkdaysInCycle = (startDate, endDate) => {
    let count = 0;
    const curDate = new Date(startDate.getTime());
    while (curDate < endDate) {
        const dayOfWeek = curDate.getDay();
        if (dayOfWeek !== 0 && dayOfWeek !== 6) { // 0 = Sunday, 6 = Saturday
            count++;
        }
        curDate.setDate(curDate.getDate() + 1);
    }
    return count;
};

const calculateEarnings = (salary, payday, now) => {
    if (salary <= 0 || !payday) {
        return {
            currentEarnings: 0,
            progress: 0,
            dDay: 0,
            hourlyWage: 0,
            dailyWage: 0,
        };
    }

    const year = now.getFullYear();
    const month = now.getMonth();
    const todayDate = now.getDate();

    // Determine the upcoming payday and the previous payday to define the pay cycle.
    let nextPayday;
    let prevPayday;

    if (todayDate > payday) {
        // We are past this month's payday, waiting for next month's.
        nextPayday = new Date(year, month + 1, payday);
        prevPayday = new Date(year, month, payday);
    } else {
        // We are waiting for this month's payday.
        nextPayday = new Date(year, month, payday);
        prevPayday = new Date(year, month - 1, payday);
    }

    // D-Day Calculation
    const diffTime = nextPayday.getTime() - now.getTime();
    const dDay = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

    // Progress and Earnings Calculation based on time elapsed in the pay cycle
    const payCycleTotalTime = nextPayday.getTime() - prevPayday.getTime();
    const payCycleElapsedTime = now.getTime() - prevPayday.getTime();
    
    let progress = 0;
    if (payCycleTotalTime > 0) {
        progress = (payCycleElapsedTime / payCycleTotalTime) * 100;
    }

    const currentEarnings = (salary * progress) / 100;

    // Wage calculations based on WORKDAYS in the pay cycle (weekends excluded).
    const workdaysInCycle = getWorkdaysInCycle(prevPayday, nextPayday);
    let dailyWage = 0;
    let hourlyWage = 0;
    
    if (workdaysInCycle > 0) {
        dailyWage = salary / workdaysInCycle;
        hourlyWage = dailyWage / 8; // Assuming 8-hour workday
    }

    return {
        currentEarnings: Math.max(0, currentEarnings),
        progress: Math.min(100, Math.max(0, progress)),
        dDay: Math.max(0, dDay),
        hourlyWage: hourlyWage,
        dailyWage: dailyWage,
    };
};

// --- Main App Component ---

const App = () => {
    // We can use React hooks directly because React is a global variable.
    const { useState, useEffect, useMemo, useCallback } = React;

    // States for saved values used in calculation
    const [salary, setSalary] = useState(() => localStorage.getItem('myPaycheckSalary') || '3000000');
    const [payday, setPayday] = useState(() => parseInt(localStorage.getItem('myPaycheckPayday') || '25', 10));

    // Temporary states for input fields
    const [inputSalary, setInputSalary] = useState(salary);
    const [inputPayday, setInputPayday] = useState(payday);

    const [currentEarnings, setCurrentEarnings] = useState(0);
    const [progress, setProgress] = useState(0);
    const [dDay, setDDay] = useState(0);
    const [hourlyWage, setHourlyWage] = useState(0);
    const [dailyWage, setDailyWage] = useState(0);
    
    const [saveMessage, setSaveMessage] = useState(null);
    
    const numericSalary = useMemo(() => Number(salary) || 0, [salary]);

    const currentDateString = useMemo(() => {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const days = ['일', '월', '화', '수', '목', '금', '토'];
        const dayOfWeek = days[now.getDay()];
        return `${year}-${month}-${day} (${dayOfWeek})`;
    }, []);

    const handleSalaryChange = (e) => {
        const rawValue = e.target.value.replace(/[^0-9]/g, '');
        setInputSalary(rawValue);
    };

    const handleSave = () => {
        setSalary(inputSalary);
        setPayday(inputPayday);
        
        localStorage.setItem('myPaycheckSalary', inputSalary);
        localStorage.setItem('myPaycheckPayday', String(inputPayday));

        // Show save confirmation message
        setSaveMessage('✓ 설정이 저장되었습니다.');
        const timer = setTimeout(() => {
            setSaveMessage(null);
        }, 2000); // Hide after 2 seconds

        // Cleanup timer
        return () => clearTimeout(timer);
    };
    
    const updateValues = useCallback(() => {
        const now = new Date();
        const { currentEarnings, progress, dDay, hourlyWage, dailyWage } = calculateEarnings(numericSalary, payday, now);
        setCurrentEarnings(currentEarnings);
        setProgress(progress);
        setDDay(dDay);
        setHourlyWage(hourlyWage);
        setDailyWage(dailyWage);
    }, [numericSalary, payday]);
    
    useEffect(() => {
        // Calculate values on initial render and when dependencies change.
        updateValues();
    }, [updateValues]);

    return (
        <div className="bg-gray-900 text-white min-h-screen flex flex-col items-center justify-center p-4 transition-all duration-500">
            <div className="w-full max-w-2xl mx-auto bg-gray-800 rounded-2xl shadow-2xl p-6 md:p-10 space-y-8 relative overflow-hidden">
                
                <div className="text-center">
                    <h1 className="text-3xl md:text-4xl font-black text-cyan-400">받을 월급</h1>
                    <p className="text-gray-400 mt-2">실시간으로 쌓이는 내 가치를 확인하세요</p>
                </div>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label htmlFor="salary" className="block text-sm font-medium text-gray-300 mb-2">월급 (원)</label>
                        <input
                            type="text"
                            inputMode="numeric"
                            id="salary"
                            value={inputSalary ? parseInt(inputSalary, 10).toLocaleString('ko-KR') : ''}
                            onChange={handleSalaryChange}
                            className="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-lg text-white focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition"
                            placeholder="예: 3,000,000"
                        />
                    </div>
                    <div>
                        <label htmlFor="payday" className="block text-sm font-medium text-gray-300 mb-2">월급날</label>
                        <select
                            id="payday"
                            value={inputPayday}
                            onChange={(e) => setInputPayday(Number(e.target.value))}
                            className="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-lg text-white focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition"
                        >
                            {Array.from({ length: 31 }, (_, i) => i + 1).map(day => (
                                <option key={day} value={day}>{day}일</option>
                            ))}
                        </select>
                    </div>
                    <div className="md:col-span-2">
                        <button 
                            onClick={handleSave}
                            className="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-4 rounded-md transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-cyan-500"
                        >
                            설정 저장
                        </button>
                    </div>
                </div>

                <div className="bg-gray-900 rounded-xl p-6 text-center space-y-4">
                    <p className="text-sm text-gray-500">{currentDateString}</p>
                    <p className="text-4xl md:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-green-300 via-cyan-400 to-blue-400 tracking-tight">
                        {Math.floor(currentEarnings).toLocaleString('ko-KR')}원
                    </p>
                    <div className="flex justify-center items-center gap-4 text-md text-gray-400 -mt-2">
                        <span>
                            일급: {Math.floor(dailyWage).toLocaleString('ko-KR')}원
                        </span>
                        <span className="border-l border-gray-600 h-4"></span>
                        <span>
                            시급: {Math.floor(hourlyWage).toLocaleString('ko-KR')}원
                        </span>
                    </div>
                    <div className="pt-4">
                         <div className="flex justify-between items-center mb-1 text-sm text-gray-300">
                            <span>진행률: {progress.toFixed(2)}%</span>
                            <span className="font-bold text-cyan-400">월급날까지 D-{dDay}일</span>
                        </div>
                        <div className="w-full bg-gray-700 rounded-full h-4 overflow-hidden">
                            <div
                                className="bg-gradient-to-r from-cyan-500 to-blue-500 h-4 rounded-full transition-all duration-1000 ease-out"
                                style={{ width: `${progress}%` }}
                            ></div>
                        </div>
                    </div>
                </div>

                {saveMessage && (
                    <div className="absolute bottom-5 right-5 bg-cyan-600 text-white py-2 px-4 rounded-lg shadow-lg animate-fade-in-out-save">
                       {saveMessage}
                    </div>
                )}
                 <style>{`
                    @keyframes fade-in-out-save {
                        0% { opacity: 0; transform: translateY(20px); }
                        20% { opacity: 1; transform: translateY(0); }
                        80% { opacity: 1; transform: translateY(0); }
                        100% { opacity: 0; transform: translateY(20px); }
                    }
                    .animate-fade-in-out-save {
                        animation: fade-in-out-save 2s ease-in-out;
                    }
                `}</style>
            </div>
            <footer className="text-center mt-8 text-gray-500 text-sm">
                <p>&copy; {new Date().getFullYear()} 받을 월급. All rights reserved.</p>
            </footer>
        </div>
    );
};


// --- App Mounting ---
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}
// Use the global ReactDOM object to render the app
const root = ReactDOM.createRoot(rootElement);
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>
);
    </script>
  </body>
</html>
